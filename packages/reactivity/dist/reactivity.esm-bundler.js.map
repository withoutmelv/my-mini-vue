{"version":3,"file":"reactivity.esm-bundler.js","sources":["../../shared/src/index.ts","../src/baseHandlers.ts","../src/reactive.ts"],"sourcesContent":["export const isObject = (res:any) => {\r\n    return typeof res === 'object' && res !== null\r\n}\r\n\r\nexport const extend = Object.assign;","import { isObject } from \"@vue/shared\";\r\nimport { track } from \"./effect\";\r\nimport { TrackOpTypes } from \"./operators\";\r\nimport { reactive, readonly } from \"./reactive\";\r\n\r\nconst get = createGetter();\r\nconst shallowGet = createGetter(false, true);\r\nconst readonlyGet = createGetter(true);\r\nconst shallowReadonlyGet = createGetter(true, true);\r\n\r\nconst set = createSetter();\r\nconst shallowSet = createSetter(true);\r\n\r\n/**\r\n * @param isReadonly 是不是仅读\r\n * @param shallow 是不是浅响应\r\n */\r\nfunction createGetter(isReadonly = false, shallow = false) {\r\n    return function get(target, key, receiver) {\r\n        const res = Reflect.get(target, key, receiver);\r\n        if (!isReadonly) {\r\n            // 依赖收集\r\n            track(target, TrackOpTypes.GET, key);\r\n        }\r\n        if (!shallow) { \r\n            // Vue3是懒代理，当深度取值时并且值为兑现时，才会进行深度代理\r\n            // Vue2的defineProperty是一上来就进行深层的数据劫持，所以Vue2有性能缺陷\r\n            if (isObject(res)) {\r\n                return isReadonly ? readonly(res) : reactive(res);\r\n            }\r\n        }\r\n        return res;\r\n    }\r\n}\r\n\r\nfunction createSetter(shallow = false) {\r\n    return function set(target, key, value, receiver) {\r\n\r\n    }\r\n}\r\n\r\nexport const mutableHandlers = {\r\n    get,\r\n    set\r\n};\r\nexport const readonlyHandlers = {\r\n    get: readonlyGet,\r\n    set(target, key) {\r\n        console.warn(`Set operation on key \"${String(key)}\" failed: target is readonly.`)\r\n        return true;\r\n    }\r\n};\r\nexport const shallowReactiveHandlers = {\r\n    get: shallowGet,\r\n    set: shallowSet\r\n};\r\nexport const shallowReadonlyHandlers = {\r\n    get: shallowReadonlyGet,\r\n    set(target, key) {\r\n        console.warn(`Set operation on key \"${String(key)}\" failed: target is readonly.`)\r\n        return true;\r\n    }\r\n};","import { isObject } from \"@vue/shared\";\r\nimport {\r\n  mutableHandlers,\r\n  readonlyHandlers,\r\n  shallowReactiveHandlers,\r\n  shallowReadonlyHandlers,\r\n} from \"./baseHandlers\"; // 不同的拦截函数\r\n\r\nexport function reactive(target) {\r\n  return createReactiveObject(target, false, mutableHandlers);\r\n}\r\n\r\nexport function shallowReactive(target) {\r\n  return createReactiveObject(target, false, shallowReactiveHandlers);\r\n}\r\n\r\nexport function readonly(target) {\r\n  return createReactiveObject(target, true, readonlyHandlers);\r\n}\r\n\r\nexport function shallowReadonly(target) {\r\n  return createReactiveObject(target, true, shallowReadonlyHandlers);\r\n}\r\n/**\r\n *\r\n * @param target 拦截的目标\r\n * @param isReadonly 是不是仅读属性\r\n * @param baseHandlers 对应的拦截函数\r\n */\r\nconst reactiveMap = new WeakMap();\r\nconst readonlyMap = new WeakMap();\r\nfunction createReactiveObject(target, isReadonly, baseHandlers) {\r\n  // 1.如果不是对象直接返回\r\n  if (!isObject(target)) {\r\n    return target;\r\n  }\r\n  const proxyMap = isReadonly ? readonlyMap : reactiveMap; // 获取缓存对象\r\n  const existingProxy = proxyMap.get(target);\r\n  // 2.代理过直接返回即可\r\n  if (existingProxy) {\r\n    return existingProxy;\r\n  }\r\n  // 3.代理的核心\r\n  const proxy = new Proxy(target, baseHandlers);\r\n  proxyMap.set(target, proxy);\r\n  // 4.返回代理对象\r\n  return proxy;\r\n}\r\n"],"names":[],"mappings":"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"}